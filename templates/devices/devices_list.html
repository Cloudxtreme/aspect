{% extends "index.html" %}
{% block main %} 
<div class="page-header">
    <h2 class="sub-header">Управление оборудованием</h2>
  <a href="{% url 'device_edit' 0 %}">Добавить новое устройство
  <span class="glyphicon glyphicon-plus-sign"></span></a>
</div>

<!-- Small modal -->
<div id='modal' class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xs">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
          <h4 class="modal-title" id="myLargeModalLabel">Список интерфейсов маршрутизатора</h4>
        </div>
        <div class="modal-body">
          <div id='ip_content'>
          </div>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

{% if devices_list %}
<table class="table h6 table-condensed table-striped">
  <thead>
    <tr>
      <th>Тип</th>
      <th>IP</th>
      <th>Местонахождение</th>
      <th>Комментарий</th>
      <th>Абонент</th>
      <th>Конфиги</th>
      <th class='col-md-1'></th>
    </tr>
  </thead>
  <tbody>
  {% for device in devices_list %}
  <tr>
    <td>{{ device.devtype }}</td>
    <td>
    {# Интерфейсы для маршрутизаторов не выводим #}
      {% if device.is_rooter %}
        <a id='#btn_iparp{{ iface.ip.pk }}' 
        onclick="var data = '{% for iface in device.interfaces.all %} <p>{{iface.ip.ip}}</p> {% endfor %}';
        $('#ip_content').html( data ); 
        $('#modal').modal('show');" data-toggle="tooltip" data-placement="left" title="Просмотреть">Просмотреть
        <span class="glyphicon glyphicon-search"></span></a>
      {% else %}
        {% for iface in device.interfaces.all %}
          {{ iface.ip.ip }}
          <a href={% url 'device_iface_edit' device.id iface.id %} data-toggle="tooltip" data-placement="left" title="Изменить"><span class="glyphicon glyphicon-edit"></span></a>

          <a href={% url 'device_iface_del' iface.id %} data-toggle="tooltip" data-placement="left" title="Удалить"><span class="glyphicon glyphicon-remove"></span></a>
        {% endfor %}
        {% if device.interfaces.all.count == 0 %}
          <a href={% url 'device_iface_add' device.id %} data-toggle="tooltip" data-placement="left" title="Добавить">Добавить <span class="glyphicon glyphicon-plus"></span></a>
        {% endif %}
      {% endif %}
    </td>
    <td>                
      {{ device.location.address }}
      <a href="{% url 'device_location_edit' device.id %}">
      <span class="glyphicon glyphicon-edit"></span></a>
      <p><small>{{ device.location.comment }}</small></p>
    </td>
    <td>{{ device.comment|safe }}</td>
    <td>
      {% for service in device.user_device.all %}
          <a href="{% url 'abonent_info' service.abon.id %}">{{ service.abon }}</a>
      {% endfor %}
    </td>
    <td>
      {% for config in device.config_set.all|slice:":2" %}
        <p class='small'><a href='{{ MEDIA_URL }}{{ config.attach }}'>{{ config.date }}</a></p>
      {% endfor %}
    </td>
    <td> 
        <p class='pull-right'><a href="{% url 'device_edit' device.pk %}">Изменить
        <span class="glyphicon glyphicon-cog"></span></a></p>
        <p class='pull-right'><a href="#">Удалить
        <span class="glyphicon glyphicon-remove"></span></a></p>
    </td>
  </tr>
  {% endfor %}
  </tbody>
</table>
{% endif %}

{% endblock %}
